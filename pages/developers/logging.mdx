import Page from "@reason/pages/Docs";
export default Page({ title: "Daemon Logging" });

# Логгинг

Логи Mina находятся в каталоге конфигурации, расположенном по адресу `~/.mina-config`. Этот каталог содержит следующие лог-файлы:

* `mina.log` - этот файл содержит последние логи daemon. Каждый лог-файл ограничен размером 10 Мебибайт (MiB) и прокручивает более чем 50 лог-файлов. Вращающиеся лог-файлы называются `mina.log.x`, начиная с `mina.log.0` и заканчивая `mina.log.50`.
* `mina-best-tip.log` - этот файл содержит логи лучших подсказок daemon. Этот файл облегчает сбор необходимых логов от нод, чтобы определить лучшее состояние для любого хардфорка. Этот файл ограничен размером 5 Мебибайт (MiB) и прокручивается над одним лог-файлом `mina-best-tip.log.0`.
* `mina-prover.log` - этот файл содержит логи использования памяти prover, а также размеров пакетов. Он ограничен 128 Мебибайтами (МiB) и прокручивается над одним лог-файлом.
* `mina-verifier.log` - этот файл содержит журналы использования памяти верификатора, а также размер пакетов. Он ограничен 128 Мебибайтами (МiB) и прокручивается над одним лог-файлом.

Чтобы следить за логами, используйте одну из следующих команд, в зависимости от того, как вы запустили daemon:

* Докер: `docker logs --follow mina`
* Запуск в качестве службы: `journalctl --user -u mina -n 1000 -f`
* Другое: `tail -f ~/.mina-config/mina.log`

### Уровни логов:

Daemon Мина ведет журнал логов на следующих уровнях, в таком порядке старшинства:

* Spam
* Trace
* Debug
* Info
* Warn
* Error
* Fatal

<Alert>

Specifying a `log-level` of `Info` will only display messages from that log level and above and significantly reduce the logs' verbosity.

</Alert>

### Log format:

The format of the logs is defined by the following structure:

```
{
  "timestamp": timestamp,
  "level": level,
  "source": {
    "module": string,
    "location": string
  },
  "message": format_string,
  "metadata": {{...}}
}
```
An example error message is shown below:

```
{
  "timestamp": "2020-12-23 21:25:04.616526Z",
  "level": "Error",
  "source": {
    "module": "Transition_router",
    "location": "File \"src/lib/transition_router/transition_router.ml\", line 231, characters 12-24"
  },
  "message": "Failed to find any peers during initialization (crashing because this is not a seed node)",
  "metadata": {
    "host": "48.241.118.000",
    "peer_id": "12D3KooWGQSPgo7ypy9717D3Vgz2RHaqB2ndDRHEFcAfJDAv284q",
    "pid": 12,
    "port": 8302
  }
}
```

### Exporting logs:

The Mina daemon provides a CLI helper to compress and package up the available log files from a node. 

For a running daemon, run `mina client export-logs` where you can pass an optional flag `-tarfile` to specify the tar archive's filename, which defaults to the current date-time. This command compresses the available logs and exports them to the `exported_logs` directory in the `~/.mina-config` directory.

<Alert>

The logs may be exported from a running node via GraphQL using the `exportLogs` [mutation](https://minaprotocol.com/docs/developers/graphql-api#mutations).

</Alert>

To export logs from a node that is not running, run the `mina client export-local-logs` command to compress the available local log files. Pass the `tarfile` option to specify the tar archive's filename, and the logs will be compressed and exported to the `exported_logs` directory in the `~/.mina-config` directory.

<Alert>

When creating or updating an issue on GitHub, you can upload the exported `tar.gz` file directly to the [issue](https://github.com/MinaProtocol/mina/issues).

</Alert>

### Logging options:

The following options may be set when starting the daemon to customize the logging behaviour:

* `-file-log-level` - log level for the log file (default: Trace)
* `-log-level` - log level for output to the terminal via stdout (default: Info)
* `-log-json` - print log output as JSON (default: plain text)
* `-log-block-creation` - log the steps involved in including transactions and snark work in a block (default: true)
* `-log-received-blocks` - log blocks received from peers (default: false)
* `-log-snark-work-gossip` - log snark-pool diffs received from peers (default: false)
* `-log-txn-pool-gossip` - log transaction-pool diffs received from peers (default: false)
* `-log-precomputed-blocks` - include precomputed blocks in the logs (default: false)

### Crash Reports:

If the daemon crashes and is able, it will generate a crash report. Only the latest crash report will be retained, with the filename indicating the date-time of the crash and the compressed file being exported to the `~/.mina-config` directory. You can upload this crash report to any [GitHub issue](https://github.com/MinaProtocol/mina/issues) to identify new issues and aid in debugging.

The crash report will contain some, or all of, the following log files:

* `crash_summary.json` - contains a summary of the crash, including the system info, the version information, and the final log output.
* `mina_status.json` - an output of the `mina client status` command for a summary of the daemon's final state.
* `mina_short.log` - contains the last 4MiB of the `mina.log` file.
* `registered_mask.dot` - contains the latest ledger visualization.
* `frontier.dot` - contains the latest frontier visualization.
* `daemon.json` - a copy of the daemon configuration file.
