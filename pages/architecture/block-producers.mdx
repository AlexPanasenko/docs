import Page from "@reason/pages/Docs";
export default Page({ title: "Block Producers" });

# Блок-продюсеры

Роль блок-продюсера в Mina заключается в достижении [консенсуса] (/docs/architecture/consensus) и обеспечении безопасности блокчейна. Блок-продюсер отвечает за создание новых блоков, которые включают в себя недавние транзакции, транслируемые в сети, и блокчейн-доказательство, которое подтверждает, что текущее состояние цепочки является действительным.

В Mina любой может стать блок-продюсером. Существует неограниченное количество участников, у которых есть шанс произвести блок пропорционально средствам в стеке. Средства не блокируются и не подлежат слэшингу.

Взамен на стейкинг средств и генерирование необходимых доказательств блокчейн, блоки, произведенные и включенные в каноническую цепь, вознаграждаются в виде монетной базы и комиссий за транзакции, за вычетом любых комиссий, уплаченных за транзакции для покупки требуемой [снарк-работы] (//docs/architecture/snark-workers).

Для успешного производства блока, блок-продюсер должен знать текущее состояние блокчейна. Кроме того, они должны иметь достаточно доступных вычислительных возможностей, чтобы произвести SNARK для блокчейна в течение времени слота и быть подключены к пирам, чтобы передать сгенерированный блок с приемлемой задержкой, определяемой параметрами сетевого консенсуса.

### Выбор блок-продюсера

Возможность произвести блок для слота определяется [верифицируемой случайной функцией](https://en.wikipedia.org/wiki/Verifiable_random_function) (VRF). Эту функцию можно рассматривать как лотерею. Каждый блок-продюсер самостоятельно запускает эту VRF для каждого слота, и, если они получат вывод, который превышает порог, пропорциональный доле производителя, у них появляется шанс произвести блок в обозначенном слоте.

Этот процесс является секретным в том смысле, что только владелец закрытого ключа может определить VRF для вывода, и поэтому только он знает, когда он должен произвести блок. Это повышает безопасность, так как злоумышленник не может нацелиться на известного блок-продюсера в определенном месте (например, путем отказа в обслуживании или целенаправленной атаки). В результате, это также означает, что для одного и того же слота могут быть выбраны несколько производителей. Если несколько блок-продюсеров производят действительный блок для одного и того же слота, это приводит к появлению форка с коротким интервалом, в котором правила консенсуса выбирают самую длинную цепочку.

Распределение стека определяется на основе реестра со SNARK на последнем блоке `current epoch-2`, поэтому существует задержка для любого недавно приобретенного или [делегированного стека](#stake-delegation). Например, если текущая эпоха - 10, то распределение стека определяется из реестра со SNARK последнего блока 8-ой эпохи.

<Alert>

Просмотреть вывод VRF в логах можно с помощью поиска `Checking VRF evaluations`.

</Alert>

### Generating a block

When a block producer is selected to produce a block for a slot, they perform the following actions:

* Choose the current best tip from their transition frontier (local store of blocks) on which to build the new block.
* Select transactions and any snark work required from the transaction and snark pools. A block producer must purchase snark work at least in equal quantity to the transactions they add to a block. In addition to any user transactions, they also add a coinbase transaction as a reward for producing the block and any fee transfers to pay the snark workers.
* Generate the proposed next state of the blockchain. This comprises creating a diff of the staged ledger that includes the account ledger and scan state (a queue of transactions yet to have proofs). This diff is applied to the existing staged ledger to produce the new state.
* Creates a blockchain proof to prove that the new state is valid. This SNARK additionally validates the prior protocol state proof.
* Creates a delta transition chain proof that proves the validity of the block if it is received within an acceptable network delay as defined by the network consensus parameters.
* Applies this newly generated state locally, adding it into the existing transition frontier.
* Broadcasts the block (referred to as an external transition) to its peers.

### Stake delegation

An account may increase the probability of being selected to produce a block by delegating tokens to another account. When staking from the delegatee account, the combined funds are used in evaluating the VRF threshold, increasing the likelihood of being selected to produce a block for a slot.

Delegated funds are not spendable and may be undelegated at any time by re-delegating the stake back to the original account.

## Supercharged coinbase

To further incentivize staking, if the account that wins the slot is one that does not have any [time-locked tokens](/docs/architecture/timelock), the block producer will receive double the coinbase rewards.

The supercharged coinbase applies to all accounts, either delegating or staking. The supercharged reward is determined using the account that won the slot. For example, if a non-time-locked account delegates to a time-locked account, if the non-time-locked account wins the slot, the coinbase is supercharged. If the time-locked account wins, the coinbase is not supercharged.
